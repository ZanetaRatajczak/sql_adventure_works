WITH RECURSIVE ProductHierarchy AS (

    SELECT ProductCategoryID, Name, NULL AS ParentID ,0 AS Level

    FROM ProductCategory

    UNION ALL

    SELECT pc.ProductCategoryID, pc.Name, ph.ProductCategoryID, ph.Level + 1

    FROM ProductCategory pc

    JOIN ProductHierarchy ph ON pc.ParentProductCategoryID = ph.ProductCategoryID

)

SELECT *

FROM ProductHierarchy

ORDER BY Level desc, Name;

